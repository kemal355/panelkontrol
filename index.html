<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MQTT Test Paneli</title>
  <!-- Paho MQTT kütüphanesi (CDN üzerinden) -->
  <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt-min.js"></script>
</head>
<body>
  <h1>MQTT Test Paneli</h1>
  <button onclick="sendMessage()">Mesaj Gönder</button>

  <script>
    console.log("MQTT bağlanıyor...");

    // 🔹 HiveMQ Cloud veya kendi broker ayarlarını buraya gir
    const host = "6db25b9004e64ab084db4a92d1576615.s1.eu.hivemq.cloud";
    const port = 8884; // wss için port
    const clientId = "webclient-" + Math.random();

    // MQTT client oluştur
    let client = new Paho.MQTT.Client(host, port, "/mqtt", clientId);

    // Callback’ler
    client.onConnectionLost = (resp) => {
      console.log("Bağlantı koptu ❌", resp);
    };
    client.onMessageArrived = (msg) => {
      console.log("Mesaj geldi:", msg.payloadString);
    };

    // Bağlan
    function connect() {
      client.connect({
        useSSL: true, // 🔹 HTTPS üzerinden geldiğimiz için şart
        userName: "kemal123", // HiveMQ Cloud kullanıcı adın
        password: "Kemal12345", // HiveMQ Cloud şifren
        onSuccess: () => {
          console.log("MQTT bağlantısı başarılı ✅");
          client.subscribe("deneme/test");
        },
        onFailure: (err) => {
          console.log("Bağlantı hatası ❌", err.errorMessage);
        }
      });
    }

    // Mesaj gönder
    function sendMessage() {
      if (client.isConnected()) {
        let msg = new Paho.MQTT.Message("Merhaba MQTT!");
        msg.destinationName = "deneme/test";
        client.send(msg);
        console.log("Mesaj gönderildi ✅");
      } else {
        console.log("❌ Broker'a bağlı değilsin!");
      }
    }

    window.onload = connect;
  </script>
</body>
</html>
