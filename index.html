<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MQTT Test Paneli</title>
  <!-- Paho MQTT (CDN) -->
  <script src="paho-mqtt.js"></script>
</head>
<body>
  <h1>MQTT Test Paneli</h1>
  <button onclick="sendMessage()">Mesaj Gönder</button>

  <script>
    let client = null; // global tanımla

    function connect() {
      console.log("MQTT bağlanıyor...");

      // 🔹 Broker bilgilerini senin HiveMQ ayarlarına göre doldur
      const host = "6db25b9004e64ab084db4a92d1576615.s1.eu.hivemq.cloud";
      const port = 8884;
      const path = "/mqtt";
      const clientId = "webclient-" + Math.random();

      client = new Paho.MQTT.Client(host, Number(port), path, clientId);

      client.onConnectionLost = (resp) => {
        console.log("Bağlantı koptu ❌", resp.errorMessage);
      };
      client.onMessageArrived = (msg) => {
        console.log("Mesaj geldi:", msg.payloadString);
      };

      client.connect({
        useSSL: true,
        userName: "kemal123",  // 🔹 senin kullanıcı
        password: "Kemal12345",          // 🔹 senin şifre
        onSuccess: () => {
          console.log("MQTT bağlantısı başarılı ✅");
          client.subscribe("deneme/test");
        },
        onFailure: (err) => {
          console.log("Bağlantı hatası ❌", err.errorMessage);
        }
      });
    }

    function sendMessage() {
      if (client && client.isConnected()) {
        let msg = new Paho.MQTT.Message("Merhaba MQTT!");
        msg.destinationName = "deneme/test";
        client.send(msg);
        console.log("Mesaj gönderildi ✅");
      } else {
        console.log("❌ Broker'a bağlı değilsin!");
      }
    }

    // Sayfa yüklenince bağlantıyı başlat
    window.onload = connect;
  </script>
</body>
</html>

