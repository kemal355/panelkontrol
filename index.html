<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MQTT Test Paneli</title>
  <!-- Paho MQTT (CDN) -->
  <script src="paho-mqtt.js"></script>
</head>
<body>
  <h1>MQTT Test Paneli</h1>
  <button onclick="sendMessage()">Mesaj GÃ¶nder</button>

  <script>
    let client = null; // global tanÄ±mla

    function connect() {
      console.log("MQTT baÄŸlanÄ±yor...");

      // ğŸ”¹ Broker bilgilerini senin HiveMQ ayarlarÄ±na gÃ¶re doldur
      const host = "6db25b9004e64ab084db4a92d1576615.s1.eu.hivemq.cloud";
      const port = 8884;
      const path = "/mqtt";
      const clientId = "webclient-" + Math.random();

      client = new Paho.MQTT.Client(host, Number(port), path, clientId);

      client.onConnectionLost = (resp) => {
        console.log("BaÄŸlantÄ± koptu âŒ", resp.errorMessage);
      };
      client.onMessageArrived = (msg) => {
        console.log("Mesaj geldi:", msg.payloadString);
      };

      client.connect({
        useSSL: true,
        userName: "kemal123",  // ğŸ”¹ senin kullanÄ±cÄ±
        password: "Kemal12345",          // ğŸ”¹ senin ÅŸifre
        onSuccess: () => {
          console.log("MQTT baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ± âœ…");
          client.subscribe("deneme/test");
        },
        onFailure: (err) => {
          console.log("BaÄŸlantÄ± hatasÄ± âŒ", err.errorMessage);
        }
      });
    }

    function sendMessage() {
      if (client && client.isConnected()) {
        let msg = new Paho.MQTT.Message("Merhaba MQTT!");
        msg.destinationName = "deneme/test";
        client.send(msg);
        console.log("Mesaj gÃ¶nderildi âœ…");
      } else {
        console.log("âŒ Broker'a baÄŸlÄ± deÄŸilsin!");
      }
    }

    // Sayfa yÃ¼klenince baÄŸlantÄ±yÄ± baÅŸlat
    window.onload = connect;
  </script>
</body>
</html>

