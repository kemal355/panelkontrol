<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>MQTT Test Paneli</title>
  <!-- Paho MQTT kÃ¼tÃ¼phanesi (CDN Ã¼zerinden) -->
  <script src="https://unpkg.com/paho-mqtt@1.1.0/paho-mqtt-min.js"></script>
</head>
<body>
  <h1>MQTT Test Paneli</h1>
  <button onclick="sendMessage()">Mesaj GÃ¶nder</button>

  <script>
    console.log("MQTT baÄŸlanÄ±yor...");

    // ğŸ”¹ HiveMQ Cloud veya kendi broker ayarlarÄ±nÄ± buraya gir
    const host = "6db25b9004e64ab084db4a92d1576615.s1.eu.hivemq.cloud";
    const port = 8884; // wss iÃ§in port
    const clientId = "webclient-" + Math.random();

    // MQTT client oluÅŸtur
    let client = new Paho.MQTT.Client(host, port, "/mqtt", clientId);

    // Callbackâ€™ler
    client.onConnectionLost = (resp) => {
      console.log("BaÄŸlantÄ± koptu âŒ", resp);
    };
    client.onMessageArrived = (msg) => {
      console.log("Mesaj geldi:", msg.payloadString);
    };

    // BaÄŸlan
    function connect() {
      client.connect({
        useSSL: true, // ğŸ”¹ HTTPS Ã¼zerinden geldiÄŸimiz iÃ§in ÅŸart
        userName: "kemal123", // HiveMQ Cloud kullanÄ±cÄ± adÄ±n
        password: "Kemal12345", // HiveMQ Cloud ÅŸifren
        onSuccess: () => {
          console.log("MQTT baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ± âœ…");
          client.subscribe("deneme/test");
        },
        onFailure: (err) => {
          console.log("BaÄŸlantÄ± hatasÄ± âŒ", err.errorMessage);
        }
      });
    }

    // Mesaj gÃ¶nder
    function sendMessage() {
      if (client.isConnected()) {
        let msg = new Paho.MQTT.Message("Merhaba MQTT!");
        msg.destinationName = "deneme/test";
        client.send(msg);
        console.log("Mesaj gÃ¶nderildi âœ…");
      } else {
        console.log("âŒ Broker'a baÄŸlÄ± deÄŸilsin!");
      }
    }

    window.onload = connect;
  </script>
</body>
</html>
